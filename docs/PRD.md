# 노션 견적서 웹뷰어 MVP PRD

## 핵심 정보

**목적**: 노션에 입력한 견적서 데이터를 고객이 웹 브라우저에서 확인하고 PDF로 저장할 수 있도록 하여, 별도 견적서 툴 없이 노션만으로 견적 업무를 처리한다.

**사용자**: 프리랜서/1인 사업자(견적서 작성자)와 그 고객(클라이언트, 견적서 수신자)

---

## 사용자 여정

```
1. [견적서 작성자] 노션 데이터베이스에 견적서 입력
   ↓ 노션 페이지 저장 후 고유 Slug/ID 생성됨

2. [견적서 작성자] 고객에게 견적서 URL 전달
   ↓ 이메일/메시지 등으로 공유

3. [고객] 견적서 공개 페이지 접근
   ↓ URL 유효성 체크

   [유효한 URL] → 견적서 상세 페이지 → 내용 확인
   [유효하지 않은 URL] → 404/오류 페이지 → 안내 메시지 표시
   ↓

4. [고객] 견적서 내용 확인 (항목, 수량, 단가, 세금, 총액)
   ↓ PDF 다운로드 버튼 클릭

5. [완료] PDF 파일 다운로드 완료
   → 고객이 파일 저장 후 검토/결재
```

---

## 기능 명세

### 1. MVP 핵심 기능

| ID | 기능명 | 설명 | MVP 필수 이유 | 관련 페이지 |
|----|--------|------|--------------|------------|
| **F001** | 견적서 데이터 조회 | 노션 API를 통해 특정 견적서 데이터를 불러옴 | 서비스의 유일한 데이터 소스 | 견적서 상세 페이지 |
| **F002** | 견적서 웹 렌더링 | 항목, 수량, 단가, 세금, 총액 등을 정형화된 레이아웃으로 표시 | 고객이 견적 내용을 확인하는 핵심 기능 | 견적서 상세 페이지 |
| **F003** | PDF 다운로드 | 현재 견적서 페이지를 PDF 파일로 변환하여 다운로드 | 고객의 최종 수령 수단 | 견적서 상세 페이지 |
| **F004** | 견적서 유효성 처리 | 존재하지 않거나 비공개 견적서 접근 시 오류 처리 | 잘못된 URL 접근 방어 | 404/오류 페이지 |

### 2. MVP 필수 지원 기능

| ID | 기능명 | 설명 | MVP 필수 이유 | 관련 페이지 |
|----|--------|------|--------------|------------|
| **F010** | 견적서 목록 (내부용) | 발행된 견적서 목록을 간단히 확인 (선택적 비밀번호 보호) | 작성자가 발행 현황을 파악하기 위한 최소 관리 화면 | 견적서 목록 페이지 |
| **F011** | 노션 데이터 캐싱 | 노션 API 응답을 일정 시간 캐싱하여 반복 호출 방지 | API 사용량 제한 및 응답 속도 개선 | 견적서 상세 페이지 |

### 3. MVP 이후 기능 (제외)

- 견적서 상태 관리 (승인/반려/협의중)
- 고객 서명 기능
- 이메일 발송 자동화
- 다국어/다통화 지원
- 견적서 템플릿 선택
- 열람 횟수/시간 트래킹

---

## 메뉴 구조

```
견적서 웹뷰어 내비게이션

공개 접근 (URL 공유)
└── 견적서 상세 페이지 (고객용 공개 URL)
    └── 기능: F001, F002, F003, F004

내부 접근 (작성자용)
└── 견적서 목록 페이지
    └── 기능: F010 (견적서 발행 현황 확인)

공통
└── 404/오류 페이지
    └── 기능: F004 (유효하지 않은 URL 처리)
```

---

## 페이지별 상세 기능

### 견적서 상세 페이지

> **구현 기능:** `F001`, `F002`, `F003`, `F004` | **접근:** 공개 URL (인증 없음)

| 항목 | 내용 |
|------|------|
| **역할** | 고객이 견적서 내용을 확인하고 PDF로 저장하는 핵심 페이지 |
| **진입 경로** | 작성자가 공유한 고유 URL로 직접 접근 (예: `/quote/[slug]`) |
| **사용자 행동** | URL 접근 후 견적서 내용 열람, PDF 다운로드 버튼 클릭 |
| **주요 기능** | - 노션 API에서 견적서 데이터 조회 (F001)<br>- 발행자 정보 표시 (회사명, 연락처, 사업자번호 등)<br>- 수신자 정보 표시 (고객명, 주소 등)<br>- 견적 항목 테이블 표시 (항목명, 수량, 단가, 소계)<br>- 합계/세금(VAT)/총액 자동 계산 표시 (F002)<br>- 견적 유효기간, 발행일 표시<br>- 특이사항/비고 텍스트 표시<br>- **PDF 다운로드** 버튼 (F003) |
| **다음 이동** | PDF 다운로드 성공 → 파일 저장 완료, 페이지 유지 / 유효하지 않은 slug → 404 페이지로 이동 |

---

### 견적서 목록 페이지

> **구현 기능:** `F010` | **접근:** 내부용 (선택적 접근 제한)

| 항목 | 내용 |
|------|------|
| **역할** | 작성자가 발행한 견적서 목록을 간단히 확인하는 내부 관리 화면 |
| **진입 경로** | 내부 URL로 직접 접근 (예: `/quotes`) |
| **사용자 행동** | 발행된 견적서 목록 확인, 개별 견적서 URL 확인 및 복사 |
| **주요 기능** | - 노션 DB의 전체 견적서 목록 조회<br>- 견적서별 고객명, 발행일, 금액, 상태 표시<br>- 견적서 공개 URL 복사 버튼<br>- 개별 견적서 페이지 링크 |
| **다음 이동** | 목록에서 항목 클릭 → 견적서 상세 페이지로 이동 |

---

### 404/오류 페이지

> **구현 기능:** `F004` | **접근:** 자동 리디렉션

| 항목 | 내용 |
|------|------|
| **역할** | 유효하지 않은 견적서 URL 접근 시 사용자 안내 |
| **진입 경로** | 존재하지 않는 slug 접근 시 Next.js 자동 라우팅 |
| **사용자 행동** | 오류 메시지 확인 |
| **주요 기능** | - "존재하지 않는 견적서입니다" 안내 메시지<br>- 작성자 연락처 안내 (선택)<br>- 홈으로 돌아가기 링크 |
| **다음 이동** | 안내 메시지 확인 후 종료 또는 작성자에게 연락 |

---

## 데이터 모델 (노션 데이터베이스 스키마)

노션 데이터베이스가 CMS 역할을 하므로, 아래 필드를 노션 DB에 정의한다.

### Quote (견적서 메인 DB)

| 필드 | 설명 | 노션 타입 |
|------|------|----------|
| title | 견적서 제목 (노션 기본 Title 필드) | Title |
| slug | 공개 URL용 고유 식별자 (예: `2026-001`) | Text |
| status | 견적서 상태 (발행/초안/만료) | Select |
| client_name | 고객(수신자) 이름/회사명 | Text |
| client_email | 고객 이메일 | Email |
| client_address | 고객 주소 | Text |
| issue_date | 발행일 | Date |
| due_date | 견적 유효기간 | Date |
| tax_rate | 세율 (기본 10%) | Number |
| notes | 특이사항/비고 | Text |
| is_public | 공개 여부 (고객 접근 허용 여부) | Checkbox |

### QuoteItem (견적 항목 DB - Quote와 연관)

| 필드 | 설명 | 노션 타입 |
|------|------|----------|
| item_name | 항목명 (작업/제품명) | Title |
| quote | 연결된 견적서 | Relation → Quote |
| quantity | 수량 | Number |
| unit_price | 단가 | Number |
| subtotal | 소계 (수량 x 단가, 수식으로 자동 계산) | Formula |
| description | 항목 설명 (선택) | Text |
| sort_order | 항목 표시 순서 | Number |

### SenderInfo (발행자 정보 - 단일 레코드 설정용)

| 필드 | 설명 | 노션 타입 |
|------|------|----------|
| company_name | 발행자 회사명/이름 | Title |
| business_number | 사업자 등록번호 | Text |
| address | 발행자 주소 | Text |
| phone | 연락처 | Phone |
| email | 이메일 | Email |
| bank_info | 계좌 정보 (입금 안내용) | Text |

---

## 기술 스택

### 프론트엔드 프레임워크

- **Next.js 15** (App Router) - 정적 생성(SSG) + 서버사이드 렌더링으로 견적서 페이지 생성
- **TypeScript 5.6+** - 노션 API 응답 타입 안전성 보장
- **React 19** - UI 라이브러리

### 스타일링 및 UI

- **TailwindCSS v4** (설정 파일 없는 CSS-first 방식) - 견적서 레이아웃 스타일링
- **shadcn/ui** (New York 스타일, Neutral 컬러) - 버튼, 테이블, 배지 컴포넌트
- **Lucide React** - 다운로드, 파일 아이콘

### 노션 연동

- **@notionhq/client** - 공식 노션 API 클라이언트
- **notion-to-md** (선택) - 노션 리치텍스트를 마크다운으로 변환

### PDF 생성

- **@react-pdf/renderer** 또는 **html2canvas + jsPDF** - 견적서 PDF 변환 및 다운로드
  - 권장: `html2canvas + jsPDF` (기존 웹 레이아웃을 그대로 PDF로 변환, 구현 간단)

### 폼 및 검증

- **Zod** - 노션 API 응답 데이터 스키마 검증

### 배포

- **Vercel** - Next.js 15 최적화, 환경변수 관리 용이

---

## 환경 변수 설계

```bash
# 노션 API
NOTION_API_KEY=secret_xxxx               # 노션 Integration API 키
NOTION_QUOTE_DB_ID=xxxx                  # 견적서 메인 DB ID
NOTION_QUOTE_ITEM_DB_ID=xxxx            # 견적 항목 DB ID
NOTION_SENDER_DB_ID=xxxx               # 발행자 정보 DB ID

# 앱 설정
NEXT_PUBLIC_APP_URL=http://localhost:3000
QUOTES_ADMIN_PATH=quotes               # 목록 페이지 내부 경로 (선택적 난독화)
```

---

## 데이터 흐름

```
[노션 DB] ──API 호출──▶ [Next.js Server Component]
                              │
                    노션 API 응답 파싱 및 타입 변환
                              │
                    ┌─────────▼─────────┐
                    │  견적서 상세 페이지  │
                    │  (서버 렌더링)      │
                    └─────────┬─────────┘
                              │
               고객 브라우저에서 HTML 렌더링
                              │
                    [PDF 다운로드 버튼 클릭]
                              │
                    html2canvas로 DOM 캡처
                              │
                    jsPDF로 PDF 생성 및 저장
```

---

## MVP 이후 확장 기능 (백로그)

| 기능 | 설명 |
|------|------|
| 견적서 상태 업데이트 | 고객이 웹에서 수락/거절 버튼 클릭 시 노션 상태 자동 업데이트 |
| 이메일 자동 발송 | 견적서 발행 시 고객에게 URL 포함 이메일 자동 발송 (Resend 등) |
| 열람 추적 | 고객이 견적서를 열람한 시각 기록 |
| 고객 서명 | 웹에서 전자 서명 후 서명 이미지를 노션에 저장 |
| 다중 통화/언어 | 원화 외 달러 등 통화, 영문 견적서 지원 |
| 견적서 템플릿 | 노션 DB 기반 여러 견적서 레이아웃 선택 |
